<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JWT Authentication</title>
</head>

<body>
    <h1>JWT Authentication Demo</h1>

    <!-- Signup Form -->
    <div id="signup">
        <h2>Signup</h2>
        <input type="text" id="signup-username" placeholder="Username" />
        <input type="password" id="signup-password" placeholder="Password" />
        <button onclick="signup()">Sign Up</button>
        <p id="signup-message"></p>
    </div>

    <hr>

    <!-- Signin Form -->
    <div id="signin">
        <h2>Signin</h2>
        <input type="text" id="signin-username" placeholder="Username" />
        <input type="password" id="signin-password" placeholder="Password" />
        <button onclick="signin()">Sign In</button>
        <p id="signin-message"></p>
    </div>

    <hr>

    <!-- User Profile -->
    <div id="profile" style="display: none;">
        <h2>Profile</h2>
        <p><b>Username:</b> <span id="profile-username"></span></p>
        <p><b>Password:</b> <span id="profile-password"></span></p>
        <button onclick="logout()">Logout</button>
    </div>

    <script>
        const API_URL = "http://localhost:3000";
        let token = "";

        // Signup Function
        async function signup() {
            const username = document.getElementById("signup-username").value;
            const password = document.getElementById("signup-password").value;

            const response = await fetch(`${API_URL}/signup`, {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify({ username, password }),
            });
            const data = await response.json();
            document.getElementById("signup-message").innerText = data.message;
        }

        // Signin Function
        async function signin() {
            const username = document.getElementById("signin-username").value;
            const password = document.getElementById("signin-password").value;

            const response = await fetch(`${API_URL}/signin`, {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify({ username, password }),
            });

            const data = await response.json();
            document.getElementById("signin-message").innerText = data.message;

            if (data.token) {
                token = data.token; // Save the token
                showProfile();
            }
        }

        // Fetch Profile Function
        async function showProfile() {
            const response = await fetch(`${API_URL}/profile`, {
                method: "GET",
                headers: {
                    "Content-Type": "application/json",
                    "token": token, // Pass the token in the headers
                },
            });

            const data = await response.json();

            if (data.username) {
                // Show profile data
                document.getElementById("profile-username").innerText = data.username;
                document.getElementById("profile-password").innerText = data.password;
                document.getElementById("signin").style.display = "none";
                document.getElementById("signup").style.display = "none";
                document.getElementById("profile").style.display = "block";
            } else {
                alert(data.message);
            }
        }

        // Logout Function
        function logout() {
            token = ""; // Clear the token
            document.getElementById("signin").style.display = "block";
            document.getElementById("signup").style.display = "block";
            document.getElementById("profile").style.display = "none";
        }
    </script>
</body>

</html>